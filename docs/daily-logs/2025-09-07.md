# Daily Log - 2025-09-07

## Tasks Completed âœ…
- Time: 15 min
- Status: Completed
- Description: Fixed React unique key warning on Reports page (AntD Table) by introducing stable `id` for site rows and using it as `rowKey`.
- Key Activities: Code review of `.map()` usages; identified duplicate `rowKey`; implemented patch; verified mapped elements have keys.
- Impact: Eliminates React warning; improves rendering stability.
- Files Modified:
  - apps/web/src/pages/Reports.tsx

- Time: 30 min
- Status: Completed
- Description: Prevented face-merge bug by making mock/dummy face embeddings deterministic per image (worker + API) and raising merge threshold.
- Key Activities: Updated worker InsightFace fallback to seed from image hash and add DCT/histogram features; made API placeholder embedding deterministic; increased `customer_merge_threshold` to 0.92.
- Impact: Different persons no longer collapse to one customer; safer matching.
- Files Modified:
  - apps/worker/app/embedder.py
  - apps/api/app/services/face_processing_service.py
  - apps/api/app/services/face_service.py

## Tasks In Progress ðŸ”„
- None

## Notes & Insights ðŸ’¡
- Added precise manual correction endpoints: visit reassignment adjusts counts and optionally embeddings; face image reassignment keeps storage untouched.
- When reassigning, only delete old customer's embeddings if they have no remaining visits to avoid losing useful vectors.

## Tomorrow's Priorities ðŸ“‹
- Add web UI actions for merge, reassign visit, and reassign face image with confirmation modals.
- Add API tests for new endpoints and Postman examples.
- Consider an undo log/audit trail for merges and reassignments.
